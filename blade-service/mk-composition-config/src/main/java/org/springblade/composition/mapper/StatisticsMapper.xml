<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.springblade.composition.mapper.StatisticsMapper">

    <select id="userCompositionCount" resultType="org.springblade.composition.dto.UserCompositionDTO">
        select u.id as userId, u.name as userName, c.id as compositionId, c.name as compositionName, count(*) as number from blade_user u
        left join mk_statistics s on u.id=s.update_user
        left join mk_composition c on s.composition_id=c.id
        left join mk_task_label l on l.id=s.sub_task_id
        where s.status = 2
        <if test="startTime!=null">
            and s.update_time &gt; #{startTime}
        </if>
        <if test="endTime!=null">
            and s.update_time &lt; #{endTime}
        </if>
        <if test="userId!=null">
            and u.id=#{userId}
        </if>
        <if test="taskId!=null">
            and l.task_id=#{taskId}
        </if>

        and s.is_deleted=0
        group by s.update_user,s.composition_id
    </select>

</mapper>
